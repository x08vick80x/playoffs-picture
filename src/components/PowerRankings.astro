---
import { getTeamId } from "../utils/team-mapping.js";

interface Ranking {
    rank: number;
    team: string; // e.g. "Lions"
    trend?: string; // e.g. "+1", "-2", "0"
    blurb: string;
}

interface Props {
    rankings: Ranking[];
}

const { rankings } = Astro.props;

const getTrendColor = (trend: string | undefined) => {
    if (!trend || trend === "0") return "neutral";
    return trend.startsWith("-") ? "negative" : "positive";
};
---

<section class="power-rankings">
    <h2 class="section-title">
        Power Rankings <span class="week-label">Week 15</span>
    </h2>

    <div class="rankings-list">
        {
            rankings && rankings.length > 0 ? (
                rankings.map((item) => {
                    const trendColor = getTrendColor(item.trend);
                    return (
                        <article
                            class="ranking-item toggle-trigger"
                            id={`rank-${item.rank}`}
                        >
                            <div class="rank-header">
                                <div class="rank-badge">
                                    <span class="rank-number">
                                        #{item.rank}
                                    </span>
                                    {item.trend && item.trend !== "0" && (
                                        <span
                                            class={`trend-indicator ${trendColor}`}
                                        >
                                            {item.trend}
                                        </span>
                                    )}
                                </div>
                                <div class="team-info">
                                    <svg
                                        class="team-logo"
                                        width="40"
                                        height="40"
                                    >
                                        <use
                                            href={`/sprites.svg#${getTeamId(item.team)}`}
                                        />
                                    </svg>
                                    <span class="team-name">{item.team}</span>
                                </div>
                                <div class="toggle-icon">
                                    <svg
                                        class="chevron"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polyline points="6 9 12 15 18 9" />
                                    </svg>
                                </div>
                            </div>
                            <div class="rank-content-wrapper">
                                <div class="rank-content">
                                    {item.blurb ? (
                                        <p>{item.blurb}</p>
                                    ) : (
                                        <p class="no-content">
                                            Analyst comment unavailable.
                                        </p>
                                    )}
                                </div>
                            </div>
                        </article>
                    );
                })
            ) : (
                <div class="empty-state">Rankings data unavailable.</div>
            )
        }
    </div>
</section>

<script>
    // Toggle logic for the entire card
    document.querySelectorAll(".toggle-trigger").forEach((item) => {
        item.addEventListener("click", (e) => {
            const contentWrapper = item.querySelector(".rank-content-wrapper");

            // Toggle expanded class on parent
            item.classList.toggle("expanded");
        });
    });
</script>

<style lang="scss">
    .power-rankings {
        max-width: 800px;
        margin: 3rem auto;
        padding: 0 1rem;
    }

    .section-title {
        text-align: center;
        font-size: 2rem;
        margin-bottom: 2rem;
        text-transform: uppercase;
        letter-spacing: 2px;

        .week-label {
            display: block;
            font-size: 1rem;
            color: var(--nfl-red);
            margin-top: 0.5rem;
        }
    }

    .rankings-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .ranking-item {
        background: var(--bg-card);
        border: 1px solid #333;
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.2s;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;

        &:hover {
            border-color: #666;
            background: rgba(255, 255, 255, 0.05);
        }

        &.expanded {
            border-color: var(--nfl-blue);

            .chevron {
                transform: rotate(180deg);
            }
        }
    }

    .rank-header {
        display: grid;
        grid-template-columns: 80px 1fr 40px;
        align-items: center;
        padding: 1rem;
    }

    .rank-badge {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 2px;
    }

    .rank-number {
        font-size: 1.4rem;
        font-weight: 800;
        color: #fff;
    }

    .trend-indicator {
        font-size: 0.8rem;
        font-weight: bold;

        &.positive {
            color: #2ecc71;
            &::before {
                content: "▲ ";
            }
        }
        &.negative {
            color: #e74c3c;
            &::before {
                content: "▼ ";
            }
        }
        &.neutral {
            color: #888;
        }
    }

    .team-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .team-name {
        font-size: 1.2rem;
        font-weight: 700;
    }

    .toggle-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888;

        .chevron {
            transition: transform 0.3s;
        }
    }

    .rank-content-wrapper {
        display: grid;
        grid-template-rows: 0fr;
        transition: grid-template-rows 0.3s ease-out;
        border-top: 1px solid transparent; // Hidden initially
    }

    .ranking-item.expanded {
        border-color: var(--nfl-blue);

        .chevron {
            transform: rotate(180deg);
        }

        .rank-content-wrapper {
            grid-template-rows: 1fr;
            border-top: 1px solid #333; // Show border when expanded
        }
    }

    .rank-content {
        overflow: hidden;
        background: rgba(0, 0, 0, 0.2);

        // Inner padding wrapper
        p,
        .no-content {
            padding: 1rem 1.5rem;
            margin: 0;
            font-size: 1rem;
            line-height: 1.6;
            color: #ddd;
            font-family: var(--font-body);
            font-weight: 400;
        }

        .no-content {
            color: #666;
            font-style: italic;
        }
    }

    .empty-state {
        text-align: center;
        color: #666;
        padding: 2rem;
    }
</style>
